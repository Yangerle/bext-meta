{"type":"javascript","name":"替换蓝奏云域名","version":"1","tags":["工具脚本"],"synopsis":"替换蓝奏云失效域名，重定向到正常域名","detail":"<p>这个脚本在检测到错误页面 ( chrome-error://chromewebdata/ ) 后，提取当前地址域名。如果是<span style=\"color: rgb(102, 163, 224);\">失效域名</span>列表的其中一个域名的话，把它替换成<span style=\"color: rgb(102, 163, 224);\">正常域名</span>，然后跳转到正常地址。</p><p>注意事项：</p><p><br></p><ol><li>这个脚本会在页面加载 100 毫秒后开始执行。如果你那边没有正常跳转，请尝试将&nbsp;<span style=\"color: rgb(102, 163, 224);\">加载延时</span>&nbsp;改的更大一些。</li><li>由于 X 浏览器 不支持在错误页面执行脚本，所以&nbsp;<strong>X 浏览器目前无法使用这个脚本</strong>。</li></ol><p><br></p><p>这个脚本使用了 Bext 的函数库，</p><p>如需二次发布 ( 分享，搬运 等等 ) ，</p><p>需要在显著位置包含如下 MIT 许可文本:</p><pre spellcheck=\"false\" class=\"ql-syntax\">MIT License\nCopyright (c) 2022 ikkz\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all\ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\nSOFTWARE.\n</pre>","source":"import { runOnce, runAt } from '@bext/util';\nimport config from '@bext/config';\nrunOnce(() => {\n    runAt(\"document-idle\", config => {\n        if (location.href === 'chrome-error://chromewebdata/') {\n            setTimeout(config => {\n                let a = document.querySelector('a');\n                a = (a) ? a.href : document.querySelector('strong').innerHTML;\n                a = new URL(a);\n                config.bad.forEach( d => {\n                    if (a.hostname.indexOf(d)>=0) location.href = a.href.replace(d,config.good);\n                });\n            }, config.delay, config);\n        }\n    }, config)\n})","configSchema":{"type":"object","properties":{"delay":{"type":"number","title":"加载延时","default":"100"},"good":{"type":"string","title":"正常域名","default":"lanzoui.com","pattern":"^(\\w+)+\\.\\w+$"},"bad":{"type":"array","items":{"type":"string","title":"失效域名","pattern":"^(\\w+)+\\.\\w+$"},"title":"失效域名列表"}},"required":["delay","good","bad"]},"defaultConfig":{"delay":100,"good":"lanzoui.com","bad":["lanzous.com","lanzoux.com"]}}