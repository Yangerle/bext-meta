{"versions":[{"hash":"6d9518937fcd3c5c480722fd12ff1ad4ff92668a","date":1642434818,"message":"chore: 移除 Meta::build","author_name":"ikkz","author_email":"miles_yang@foxmail.com","version":"2"},{"hash":"8e819cfe9d9fcf704b0f4550c44e6769dd93dcd2","date":1642259646,"message":"ui 和插件更新 ui.js : bextBar : 贴靠 和 点击按钮收起 98778 : 适配 bext/config / 加入 toast 提示 / 更新 lib 和介绍 98776 / 98777 : 更新 lib","author_name":"Lemon399","author_email":"1446744399@qq.com","version":"2"},{"hash":"9c3df7f9ba5c5b641182832c82d701e1bcfeec91","date":1641448582,"message":"98778 : 更新 1. 加入 记忆状态 开关 2. 不支持 Clipboard API 时直接中断，避免影响其它脚本。","author_name":"Lemon399","author_email":"1446744399@qq.com","version":"1"},{"hash":"61771e59bee25850de8cedd7ea932cdc82210b69","date":1641393342,"message":"98778 : 首次提交","author_name":"Lemon399","author_email":"1446744399@qq.com","version":"1"}],"meta":{"type":"javascript","name":"限制自动复制","version":"2","tags":["工具脚本"],"source":"import { runOnce, runAt } from '@bext/util';\nimport { getBextBar, toast } from '@bext/ui';\nimport config from '@bext/config';\n\nrunOnce(() => {\n    if (!navigator.clipboard) return;\n    \n    let origExecCmd = document.execCommand,\n        origClipWrite = navigator.clipboard.write,\n        origClipWriteText = navigator.clipboard.writeText,\n        copyCount = 0, copyStat = false, storKey = 'autoCopy_stat';\n\n    if (window.localStorage.hasOwnProperty(storKey)) {\n        if (config.storage) {\n            config.enable = (window.localStorage.getItem(storKey)==0) ? true : false;\n        } else {\n            window.localStorage.removeItem(storKey);\n        }\n    }\n    \n    function addCount() {\n        let bar = getBextBar();\n        copyCount++;\n        if (bar.query('autoCopy')) bar.change('autoCopy', {\n            text: `限制自动复制 (${copyCount})`,\n        });\n    }\n    function recordCopy(cmd,...arg){\n        if (cmd=='copy') {\n            addCount();\n        } else {\n            origExecCmd(cmd,...arg);\n        }\n    };\n    function recordCopyPromise(){\n        return new Promise(resolve => {\n            addCount();\n            resolve();\n        });\n    };\n    function lockCopy(lock){\n        document.execCommand = lock ? recordCopy : origExecCmd;\n        navigator.clipboard.write = lock ? recordCopyPromise : origClipWrite;\n        navigator.clipboard.writeText = lock ? recordCopyPromise : origClipWriteText;\n        copyStat = lock ? false : true;\n        copyCount = 0;\n        if (config.storage) window.localStorage.setItem(storKey,lock ? 0 : 1);\n    };\n    lockCopy(config.enable);\n    runAt('document-idle', function () {\n        let text = ['允许自动复制', '限制自动复制'];\n        getBextBar().add('autoCopy', {\n            text: (config.enable) ? text[1] : text[0],\n            textcolor: 'white',\n            backcolor: (config.enable) ? 'crimson' : 'limegreen',\n            callback: bar => {\n                if (copyStat) {\n                    bar.change('autoCopy', {\n                        text: text[1],\n                        backcolor: 'crimson'\n                    });\n                } else {\n                    bar.change('autoCopy', {\n                        text: text[0],\n                        backcolor: 'limegreen'\n                    });\n                }\n                lockCopy(copyStat);\n                toast(copyStat ? text[0] : text[1]);\n            },\n        });\n    })\n})","synopsis":"限制网站自动向剪贴板复制内容。","detail":"<p>启动后默认是开启限制的，</p><p>你可以点 按钮栏 上的开关 来允许自动复制。</p><p>脚本带有按域名记忆功能，自动记忆域名开关状态。</p><p><br></p><p>注意，这个脚本限制的只是使用 API 的自动复制。</p><p>对于那些 模拟 Ctrl + C 按键的自动复制无效。</p><p>对于你手动复制也是不会限制的。</p><p><br></p><p>这个脚本需要 WebView 66 以上内核才可使用，</p><p>且只能在 http:// 或 https:// 协议中使用。</p>","extra":{"xMetaComment":"// @run-at document-start"},"configSchema":{"type":"object","properties":{"enable":{"type":"boolean","title":"默认状态","description":"勾选代表默认限制自动复制。","default":false},"storage":{"type":"boolean","title":"记忆状态","description":"按网站域名记忆状态，新访问的网站将会是默认状态。","default":false}},"required":["enable","storage"]},"defaultConfig":{"enable":true,"storage":true}},"hash":"6d9518937fcd3c5c480722fd12ff1ad4ff92668a"}