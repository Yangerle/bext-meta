{"type":"javascript","name":" 自动拼接下一页","version":"1","synopsis":"已适配百度、谷歌、搜狗、神马、必应","tags":["工具脚本","阅读脚本"],"detail":"<p>搬运自 <a rel=\"noopener noreferrer\" href=\"http://via-app.cn/#/pluginDetail/32\">Via 轻插件</a> ，作者 <a rel=\"noopener noreferrer\" href=\"http://via-app.cn/#/user/2\">谷花泰</a></p><p><br></p><p>以下是原版介绍 ：</p><p><br></p><h1>自动拼接下一页</h1><p><br></p><h2><span style=\"background-color: rgb(250, 204, 204);\"> </span> 简介</h2><p><br></p><p>在百度搜索时总是要手动点下一页？</p><p>不，我拒绝，高效从懒惰开始，自动下一页走起。</p><p>已适配：&nbsp;<code style=\"color: rgb(240, 102, 102); background-color: rgba(27, 31, 35, 0.05);\">百度搜索</code><span style=\"color: rgb(240, 102, 102);\">&nbsp;</span><code style=\"color: rgb(240, 102, 102); background-color: rgba(27, 31, 35, 0.05);\">谷歌搜索</code><span style=\"color: rgb(240, 102, 102);\">&nbsp;</span><code style=\"color: rgb(240, 102, 102); background-color: rgba(27, 31, 35, 0.05);\">必应搜索</code><span style=\"color: rgb(240, 102, 102);\">&nbsp;</span><code style=\"color: rgb(240, 102, 102); background-color: rgba(27, 31, 35, 0.05);\">搜狗搜索</code><span style=\"color: rgb(240, 102, 102);\">&nbsp;</span><code style=\"color: rgb(240, 102, 102); background-color: rgba(27, 31, 35, 0.05);\">神马搜索</code><span style=\"color: rgb(240, 102, 102);\">&nbsp;</span><code style=\"color: rgb(240, 102, 102); background-color: rgba(27, 31, 35, 0.05);\">夸克搜索</code><span style=\"color: rgb(240, 102, 102);\">&nbsp;</span><code style=\"color: rgb(240, 102, 102); background-color: rgba(27, 31, 35, 0.05);\">360搜索</code></p><p><strong style=\"color: rgb(240, 102, 102);\">如果没效果就刷新一下</strong></p><p><strong style=\"color: rgb(240, 102, 102);\">加载下一页是要时间的，滑动太快就要稍等</strong></p><p><br></p><h2><span style=\"background-color: rgb(250, 204, 204);\"> </span> 测试链接</h2><p><br></p><p><a style=\"color: rgb(240, 102, 102);\" rel=\"noopener noreferrer\" href=\"https://m.baidu.com/s?word=%E5%B0%8F%E7%B1%B3\">百度搜索-测试</a></p><p><a style=\"color: rgb(240, 102, 102);\" rel=\"noopener noreferrer\" href=\"https://www.google.com/search?q=%E5%B0%8F%E7%B1%B3\">谷歌搜索-测试</a></p><p><a style=\"color: rgb(240, 102, 102);\" rel=\"noopener noreferrer\" href=\"https://cn.bing.com/search?q=%E5%B0%8F%E7%B1%B3\">必应搜索-测试</a></p><p><a style=\"color: rgb(240, 102, 102);\" rel=\"noopener noreferrer\" href=\"https://m.sogou.com/web/searchList.jsp?pg=webSearchList&amp;eqs=rVSFk%2FvMZYOlpt34RZ6LDGuFLB0JSWshqxm47AARoQokqqJQ0Plfi%2BfOjZ5f5fymevckzaUb9XZF0uFR49pbJcfbkLOeYI8%2FFq0HaMHTOUbxYuyQUu6DwssY%2BbIAyM%2BnV3ZeXykA6YAkBLyeRgJ3VCV%2FPpqt5hymryf00DK6b6t44EAdYV8BxauSwGzxNCmvvshbiX6xr8BpzUonbStos2InBN7X9moN3%2BgWFG2OWNFZiD1BOKapITkJq%2F%2F4mqyQowGNgA6pCbP1XCwsBejg6YhHGGcR1gpzE7NYid1wk8Vc0ksAIqLHHrfuppZplQOFMugD4Mcd711Q8gUNm5vyRZyQNoDrtuF7qtJo6U%2FNDeL4jo1WR7SNbcPtJn71orIasLM7MV9%2FDqHa9V0BHFovnZnPzKEPONyGkaz%2F%2BOp4hrUd1FBZy64XSTY30RWxtkCk3jhSlvzdJ9K8HPBTChul4peEhCVNa95cqTKH6ly3J7LpwwFRJ3PJe55S91pnCZA6hXPS%2FqnoClFeiaQQ0RRPFZvucwcmGqDAyAFqJRGQThypgKWFMW9pv1QJlkFapav9d%2ByP%2FI5on2ZSFmBgTKThF%2B81rquR7J3glNyTbGY1c7lfVEtbB4rDIuzKdl8cRB75\">搜狗搜索-测试</a></p><p><a style=\"color: rgb(240, 102, 102);\" rel=\"noopener noreferrer\" href=\"https://m.sm.cn/s?q=%E5%B0%8F%E7%B1%B3\">神马搜索-测试</a></p><p><a style=\"color: rgb(240, 102, 102);\" rel=\"noopener noreferrer\" href=\"https://quark.sm.cn/s?q=%E5%B0%8F%E7%B1%B3&amp;uc_param_str=dnntnwvepffrgibijbprsvpidicheiutds\">夸克搜索-测试</a></p><p><a style=\"color: rgb(240, 102, 102);\" rel=\"noopener noreferrer\" href=\"https://m.so.com/s?q=%E5%B0%8F%E7%B1%B3\">360搜索-测试</a></p>","source":"/*\n * @name: 自动拼接下一页\n * @Author: 谷花泰\n * @version: 1.0\n * @description: 已适配百度、谷歌、搜狗、神马、必应\n * @include: *\n * @createTime: 2019-11-16 23:10:18\n * @updateTime: 2019-11-17 07:33:04\n */\n(function () {\n  /* 执行判断 */\n  const key = encodeURIComponent('谷花泰:自动拼接下一页:执行判断');\n  if (window[key]) {\n    return;\n  };\n  window[key] = true;\n\n  class AutoNextPage {\n    /**\n     * 初始化配置\n     */\n    constructor(_configs) {\n      const that = this;\n      this.configs = _configs;\n      /* 最终配置  */\n      this.config = {};\n\n      /* 是否执行代码 */\n      const canLoad = this.configs.some(config => {\n        if (that.siteInList(config.sites)) {\n          that.config = config;\n        };\n        return that.siteInList(config.sites);\n      });\n      if (!canLoad) {\n        return;\n      };\n\n      /* 添加样式 */\n      this.addStyle(this.config.style || '');\n\n      /* 保存获取链接的方法 */\n      this._getNextPageUrl = this.config.getNextPageUrl || this.getNextPageUrl;\n\n      /* 获取下一页方法 */\n      this._getNextPage = this.config.getNextPage || null;\n\n      /* 请求状态判断 */\n      this.isRequesting = false;\n\n      /* 上一次的文档高度 */\n      this.lastScrollHeight = top.document.documentElement.scrollHeight;\n      this.init();\n    };\n    /**\n     * 监听滚动\n     */\n    init() {\n      const html = top.document.documentElement;\n\n      /* 刚进来直接加载下一页 */\n      this.loadNextPage();\n      window.addEventListener('scroll', this.debounce(() => {\n        if (html.scrollTop >= this.lastScrollHeight) {\n          this.loadNextPage();\n        };\n      }, 10));\n    };\n    /**\n     * 判断网站是否在名单内，支持正则\n     */\n    siteInList(sites) {\n      const hostname = window.location.hostname;\n      const result = sites.some(site => {\n        if (hostname.match(site)) {\n          return true;\n        }\n        return false;\n      });\n      return result;\n    };\n    /**\n     * 默认获取下一页链接的方法\n     */\n    getNextPageUrl() {\n      const nextPageNodes = document.querySelectorAll('.se-page-controller a');\n      const nextPageNode = nextPageNodes[nextPageNodes.length - 1];\n      return nextPageNode && nextPageNode.getAttribute('href') || '';\n    };\n    /**\n     * 根据 url 获取已渲染的 dom 的 html 代码\n     */\n    getFrameHtml(url) {\n      return new Promise((resolve, reject) => {\n        const iframe = top.document.createElement('iframe');\n        iframe.src = url;\n        iframe.setAttribute('style', `\n          position:fixed; \n          width:0; \n          height:0; \n          overflow:hidden; \n          opacity:0;\n        `);\n        top.document.body.appendChild(iframe);\n        const framesLength = top.frames.length;\n        iframe.onload = () => {\n          const lastWindow = top.frames[framesLength - 1] || top;\n          const html = lastWindow.document.body.innerHTML;\n          resolve(html);\n          this.isRequesting = false;\n          top.document.body.removeChild(iframe);\n        };\n      });\n    };\n    /**\n     * 添加样式\n     */\n    addStyle(css) {\n      const style = document.querySelector('style') || document.createElement('style');\n      style.innerHTML += css;\n    };\n    /**\n     * 防抖函数\n     */\n    debounce(fn, delay) {\n      let timer = null;\n      return function () {\n        clearTimeout(timer);\n        timer = setTimeout(() => {\n          fn.apply(this, arguments);\n        }, delay);\n      };\n    };\n    /**\n     * 加载下一页\n     */\n    loadNextPage() {\n      /* 点击类 */\n      if (this._getNextPage) {\n        this.lastScrollHeight = top.document.documentElement.scrollHeight;\n        this._getNextPage();\n        console.log('点击类：加载下一页');\n        return;\n      };\n\n      /* 链接类 */\n      const nextPageUrl = this._getNextPageUrl();\n      if (this.isRequesting) {\n        return;\n      };\n      console.log('链接类：加载下一页', nextPageUrl);\n      this.isRequesting = true;\n      this.getFrameHtml(nextPageUrl).then(html => {\n        this.lastScrollHeight = top.document.documentElement.scrollHeight;\n        top.document.body.innerHTML += `\n          <div class=\"via-next-page\">\n            ${html}\n          </div>\n        `;\n      });\n    };\n  };\n\n  try {\n    const configs = [\n      {\n        sites: ['m.baidu.com', 'www.baidu.com'],\n        style: `\n          .se-page-ft,\n          .se-page-copyright.se-copyright-zbios {\n            display: none !important;\n          }\n        `,\n        getNextPageUrl() {\n          const nextPageNodes = document.querySelectorAll('.se-page-controller a');\n          const nextPageNode = nextPageNodes[nextPageNodes.length - 1];\n          let nextPageLink = nextPageNode && nextPageNode.getAttribute('href') || '';\n          let reg = /(https*?:\\/\\/\\w+\\.\\w+?\\.com)([\\w\\W]*)/i;\n          nextPageLink = nextPageLink.replace(reg, (res, $1, $2) => {\n            return top.location.origin + $2;\n          });\n          return nextPageLink;\n        }\n      },\n      {\n        sites: ['www.google.com'],\n        style: `\n          #sfooter {\n            display: none !important;\n          }\n        `,\n        getNextPageUrl() {\n          const moreResultNodes = document.querySelectorAll('a[aria-label=\"更多结果\"]');\n          const moreResultNode = moreResultNodes[moreResultNodes.length - 1];\n          const moreResultLink = moreResultNode && moreResultNode.getAttribute('href') || '';\n\n          const nextPageNodes = document.querySelectorAll('a[aria-label=\"下一页\"]');\n          const nextPageNode = nextPageNodes[nextPageNodes.length - 1];\n          const nextPageLink = nextPageNode && nextPageNode.getAttribute('href') || '';\n\n          return nextPageLink || moreResultLink;\n        }\n      },\n      {\n        sites: ['m.sogou.com', 'wap.sogou.com'],\n        style: ``,\n        getNextPage() {\n          const nextPageNodes = document.querySelectorAll('a.nextpage');\n          const nextPageNode = nextPageNodes[nextPageNodes.length - 1];\n          nextPageNode && nextPageNode.click();\n        }\n      },\n      {\n        sites: ['m.sm.cn', 'quark.sm.cn'],\n        style: ``,\n        getNextPage() {\n          const nextPageNodes = document.querySelectorAll('span.p-next');\n          const nextPageNode = nextPageNodes[nextPageNodes.length - 1];\n          nextPageNode && nextPageNode.click();\n        }\n      },\n      {\n        sites: ['cn.bing.com'],\n        style: `\n          .b_footer,\n          .b_msg {\n            display: none !important;\n          }\n        `,\n        getNextPageUrl() {\n          const nextPageNodes = document.querySelectorAll('[title=\"下一页\"]');\n          const nextPageNode = nextPageNodes[nextPageNodes.length - 1];\n          let nextPageLink = nextPageNode && nextPageNode.getAttribute('href') || '';\n          let reg = /(https*?:\\/\\/\\w+\\.\\w+?\\.com)([\\w\\W]*)/i;\n          nextPageLink = nextPageLink.replace(reg, (res, $1, $2) => {\n            return top.location.origin + $2;\n          });\n          return nextPageLink;\n        }\n      },\n      {\n        sites: ['m.so.com'],\n        style: ``,\n        getNextPage() {\n          const nextPageNodes = document.querySelectorAll('.load-more');\n          const nextPageNode = nextPageNodes[nextPageNodes.length - 1];\n          nextPageNode && nextPageNode.click();\n        }\n      }\n    ];\n\n    if (document.readyState === 'complete') {\n      new AutoNextPage(configs);\n      return;\n    };\n    window.addEventListener('load', () => {\n      new AutoNextPage(configs);\n    });\n  } catch (err) {\n    console.log(':自动拼接下一页：', err);\n  };\n})();"}