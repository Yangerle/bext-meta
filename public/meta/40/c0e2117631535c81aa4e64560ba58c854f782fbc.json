{"type":"javascript","name":" 下拉刷新","version":"1","synopsis":"位于页面顶端时下拉刷新","tags":["工具脚本","其他脚本"],"detail":"<p>搬运自 <a rel=\"noopener noreferrer\" href=\"http://via-app.cn/#/pluginDetail/40\">Via 轻插件</a> ，作者 <a rel=\"noopener noreferrer\" href=\"http://via-app.cn/#/user/28\">Sky</a></p><p>对原脚本进行如下修改 ：</p><ol><li>适配本站安装选项</li></ol><p>以下是原版介绍 ，忽略版本备注：</p><p><br></p><h2><span style=\"background-color: rgb(250, 204, 204);\"> </span> 脚本作用：</h2><p><br></p><p>当你已经划到网页最顶端时，浏览区域内任意地方<strong style=\"color: rgb(240, 102, 102);\">继续单指下划，即可刷新网页</strong>（下划<strong style=\"color: rgb(240, 102, 102);\">需要较长距离</strong>）。作者是因为之前用惯了夸克，觉得下拉刷新对于单手使用比较友好，就在这边写了一个脚本以实现该功能。</p><p><br></p><ul><li>作者很懒，因此该脚本只有功能没有视觉效果，想知道下划阈值距离的话，请多试几次慢慢感受。</li></ul><p><br></p><p><br></p><h2><span style=\"background-color: rgb(250, 204, 204);\"> </span> 何时作用：</h2><p><br></p><p><strong style=\"color: rgb(240, 102, 102);\">基本通用</strong>，前提是等网页加载完成，这样脚本才能运行起来。</p><ul><li>总的来说体验肯定不如浏览器本身支持的好，期待官方在之后版本中加入该功能。</li></ul><p><br></p><h2><span style=\"background-color: rgb(250, 204, 204);\"> </span> 测试链接</h2><p><br></p><p><a style=\"color: rgb(240, 102, 102);\" rel=\"noopener noreferrer\" href=\"https://www.coolapk.com/apk/\"><strong>点击进入测试网页</strong></a></p><p><br></p><ul><li>注：大部分网页都可以进行测试，只需要<strong style=\"color: rgb(240, 102, 102);\">在安装脚本后正常刷新一次</strong>网页使得脚本起效。</li></ul><h2><br></h2><h2><span style=\"background-color: rgb(250, 204, 204);\"> </span> 可能存在的BUG：</h2><p><br></p><p>已知无缓存<strong style=\"color: rgb(240, 102, 102);\">第一次</strong>打开桌面版网页（或其他响应较慢的网页）时，有概率不生效（此时其他脚本和广告过滤亦不生效，可能是脚本管理机制的问题），遇到不生效问题时<strong style=\"color: rgb(240, 102, 102);\">刷新网页</strong>即可解决。</p><p> 已知和<a style=\"color: rgb(240, 102, 102);\" rel=\"noopener noreferrer\" href=\"http://via-app.cn/\">via-app.cn</a>网站本身有兼容问题，会导致未到达页面顶部即可触发刷新，原因是不能正常获取页面 document.body.scrollTop 和 document.documentElement.scrollTop 之中任何一个的值，若有解决方案或其他建议欢迎反馈。</p>","source":"/*\n * @name: 下拉刷新\n * @Author: Sky\n * @version: 1.7\n * @description: 位于页面顶端时下拉刷新\n * @include: *\n * @createTime: 2020-3-6 01:00\n * @updateTime: 2020-10-9 21:10\n */\nimport config from '@bext/config';\n(function(){const\n/*等号后的数表示最小触发下拉距离(px)*/\n min_dY = config.down,\n/*－－－－以下勿改－－－－*/\nkey=encodeURIComponent('下拉刷新:执行判断');if(window[key]){return;}try{window[key]=true;let strtX,strtY=0,rchTp,onePt=false;document.addEventListener('touchstart',function(e){if(onePt){rchTp=false;}else{onePt=true;rchTp=(document.body.scrollTop||document.documentElement.scrollTop)<50;strtX=e.touches[0].screenX;strtY=e.touches[0].screenY;}},{'passive':true});document.addEventListener('touchend',function(e){if(rchTp){const dY=Math.floor(e.changedTouches[0].screenY-strtY);if(dY>min_dY&&Math.abs(e.changedTouches[0].screenX-strtX)<(0.4*dY)){location.reload();}rchTp=false;}onePt=false;},{'passive':true,'capture':true});}catch(err){console.log('下拉刷新：',err);}})();","configSchema":{"type":"object","properties":{"down":{"type":"number","title":"最小触发下拉距离 (px)"}},"required":["down"]},"defaultConfig":{"down":300}}