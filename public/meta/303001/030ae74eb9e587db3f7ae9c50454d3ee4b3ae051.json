{"type":"javascript","name":"网页弹窗拦截","version":"1.0.0","tags":["工具脚本","其他脚本"],"synopsis":"弹窗次数过多时询问是否拦截某弹窗","source":"/*\n* @name: 网页弹窗拦截\n* @Author: undefined303（残月un）\n* @version: 1.0.0\n* @include: *\n*/\n\nimport config from '@bext/config';\n\n(function () {\n  'use strict';\n  const\n    CONFIRM_COUNT = config.CONFIRM_COUNT;\n  /*当某弹窗弹出次数达到此值的倍数时，询问是否拦截*/\n  const ASK_IGNORE_COUNT = config.ASK_IGNORE_COUNT || null;\n  /*当询问是否拦截次数达到该值的次数时，询问是否放行，填null则不会询问*/\n  const IGNORED_SITE = config.IGNORED_SITE || [];\n  /*白名单网站：将网站完整地址或域名用\"\"包裹，并用英文逗号隔开\n  示例：\n       单个网站\n  const IGNORED_SITE =[\"example.com\"]\n       多个网站\n  const IGNORED_SITE =[\"example1.com\",\"https://example2.com/example\"]\n  */\n  /*****************以下勿改*****************/\n  const key = encodeURIComponent('网页弹窗拦截');\n  if (window[key]) {\n    return;\n  };\n  window[key] = true;\n  IGNORED_SITE.forEach((item, index) => {\n    try {\n      IGNORED_SITE[index] = new URL(item).href\n    } catch (e) {/*ignore error*/ }\n  });\n  if (!(IGNORED_SITE.indexOf(document.domain) != -1 || IGNORED_SITE.indexOf(location.href) != -1)) {\n    console.log(\"启用网页弹窗拦截\")\n    const originalConfirm = window.confirm;\n    [\"alert\", \"confirm\", \"prompt\"].forEach((method) => {\n      let count = 0;\n      let count_time = 1;\n      let ignore = false;\n      let ask = true;\n      const fn = window[method];\n      window[method] = function () {\n        if (ignore) {\n          return undefined;\n        }\n        const result = fn((arguments.length == 0) ? \"\" : String(arguments[0]));\n        count++;\n        if (count == CONFIRM_COUNT * count_time) {\n          if (ask) {\n            ignore = originalConfirm(\n              `当前网页已弹出${method}弹窗${count}次，是否忽略后续该弹窗`);\n          }\n          if (ASK_IGNORE_COUNT != null && !ignore) {\n            if (count_time == ASK_IGNORE_COUNT && originalConfirm(`是否本次放行本网站的${method}弹窗`)) {\n              ask = false;\n            }\n          }\n          count_time++;\n        }\n        return result;\n      };\n    });\n  }\n})();","detail":"<p>网页弹窗有三种：alert，confirm，prompt，分别为：警告框，确认框和输入框，有的网站会滥用这三种弹窗，给用户造成极大的干扰。</p><p>脚本安装选项（可修改）</p><p><strong>CONFIRM_COUNT</strong></p><p>当某类弹窗弹出次数达该参数的倍数时，询问是否拦截该类弹窗，拦截刷新解除</p><p><strong>ASK_IGNORE_COUNT</strong></p><p>当询问是否拦截次数达到该值的次数时，询问是否放行，不填则不会询问</p><p><strong>IGNORED_SITE</strong></p><p>白名单网站</p>","extra":{"xMetaComment":"// @run-at document-start"},"configSchema":{"type":"object","properties":{"CONFIRM_COUNT":{"type":"number","description":"当某弹窗弹出次数达到此值的倍数时，询问是否拦截","minimum":1},"ASK_IGNORE_COUNT":{"type":"number","description":"当询问是否拦截次数达到该值的次数时，询问是否放行，不填则不会询问","minimum":1},"IGNORED_SITE":{"type":"array","items":{"type":"string"},"description":"白名单网站，例如 example.com 或者 https://example.com，点击加号添加多个"}},"required":["CONFIRM_COUNT"]},"defaultConfig":{"CONFIRM_COUNT":5,"ASK_IGNORE_COUNT":3,"IGNORED_SITE":[]}}