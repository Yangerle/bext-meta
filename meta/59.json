{"type":"javascript","name":"复制授权","version":"1","synopsis":"管理网页复制行为","tags":["工具脚本","其他脚本"],"detail":"<p>搬运自 <a rel=\"noopener noreferrer\" href=\"http://via-app.cn/#/pluginDetail/59\">Via 轻插件</a> ，作者 <a rel=\"noopener noreferrer\" href=\"http://via-app.cn/#/user/28\">Sky</a></p><p>对原脚本进行如下修改 ：</p><ul><li>适配本站安装选项</li></ul><p>以下是原版介绍，有删改：</p><p><br></p><h2>⚠️前排提示：</h2><h3>该脚本与复制限制解除类脚本<strong style=\"color: rgb(240, 102, 102);\">不兼容</strong>！若需要该脚本请卸载解除限制类的脚本。</h3><p><br></p><h2><span style=\"background-color: rgb(240, 102, 102);\"> </span> 脚本作用：</h2><p><br></p><p>专防网页后台复制各种口令。脚本起效后网页右侧会出现半透明小红点：红色状态表示拦截所有复制行为，点击红点变成绿色时临时放行所有复制，再点击变回红色状态。</p><p><br></p><h2><span style=\"background-color: rgb(240, 102, 102);\"> </span> 测试链接：</h2><p><br></p><p><a style=\"color: rgb(240, 102, 102);\" rel=\"noopener noreferrer\" href=\"https://baike.baidu.com/item/%E6%98%8E%E5%B9%B4%E4%BB%8A%E6%97%A5/6666499\">点击进入测试页面</a></p><p><br></p><h2><span style=\"background-color: rgb(240, 102, 102);\"> </span> 免责声明：</h2><p><br></p><ul><li>此插件仅适用于个人技术研究学习，请勿商用。</li><li>出现任何法律纠纷，与作者无关。</li></ul><p><br></p>","source":"/*\n * @name: 复制授权\n * @Author: Sky\n * @version: 1.4\n * @description: 管理网页复制行为\n * @include: *\n * @createTime: 2020-8-8 11:55\n * @updateTime: 2021-11-7 23:10\n */\nimport config from '@bext/config';\n(function(){const\n/* 等号后的数可供修改\n 1为是 0为否 */\nneedc = config.needc, /* 拦截复制时是否弹窗确认 */\nshows = config.shows, /* 是否显示小红点开关 */\n/*－－－－以下勿改－－－－*/\n key = encodeURIComponent('复制授权:执行判断');\n if(window[key]){return;}\n try {\n  window[key] = true;\n  let red = true,\n  lastCopyTime = 0;\n  function copyHandle(e){\n   function stopCopy(){e.preventDefault();e.stopImmediatePropagation();lastCopyTime = Date.now();}\n   if(Date.now() - lastCopyTime < 100){stopCopy();return;}\n   if(red && !(needc && confirm('网页正在尝试复制，是否允许？'))){stopCopy();}\n  }\n  document.addEventListener('copy',(e)=>copyHandle(e),{'passive':false, 'capture':true});\n  Array.from(document.getElementsByTagName('iframe')).forEach((i)=>i.contentDocument.addEventListener('copy',(e)=>copyHandle(e),{'passive':false, 'capture':true}));\n  if(shows){\n   const sw = document.createElement(\"div\");\n   sw.style = 'position:fixed!important;bottom:45%;right:10px;z-index:999999;width:14px;height:14px;opacity:0.4;border-radius:7px;background:red';\n   document.body.appendChild(sw);\n   sw.addEventListener('touchmove', function(e){\n    sw.style.right = sw.style.bottom = '';\n    sw.style.left = (e.touches[0].clientX - 7) + 'px';\n    sw.style.top = (e.touches[0].clientY - 7) + 'px';\n   }, {'passive':true});\n   sw.addEventListener('click', function(e){\n    sw.style.background = red ? 'green' : 'red'\n    red = !red;\n   }, {'passive':true});\n  }\n } catch(err){console.log('复制授权：', err);}\n})();","configSchema":{"type":"object","properties":{"needc":{"type":"boolean","title":"弹窗确认"},"shows":{"type":"boolean","title":"显示小红点"}},"required":["shows","needc"]},"defaultConfig":{"needc":true,"shows":true}}